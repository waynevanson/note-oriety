const L=(t,e)=>t===e,d=Symbol("solid-proxy"),G=Symbol("solid-track"),b={equals:L};let x=k;const f=1,g=2,O={owned:null,cleanups:null,context:null,owner:null};var i=null;let m=null,D=null,u=null,o=null,a=null,E=0;function I(t,e){const s=u,r=i,n=t.length===0,l=e===void 0?r:e,c=n?O:{owned:null,cleanups:null,context:l?l.context:null,owner:l},T=n?t:()=>t(()=>y(()=>h(c)));i=c,u=null;try{return p(T,!0)}finally{u=s,i=r}}function K(t,e){e=e?Object.assign({},b,e):b;const s={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},r=n=>(typeof n=="function"&&(n=n(s.value)),U(s,n));return[C.bind(s),r]}function M(t,e,s){const r=A(t,e,!1,f);w(r)}function Q(t,e,s){x=j;const r=A(t,e,!1,f);r.user=!0,a?a.push(r):w(r)}function V(t,e,s){s=s?Object.assign({},b,s):b;const r=A(t,e,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=s.equals||void 0,w(r),C.bind(r)}function W(t){return p(t,!1)}function y(t){if(u===null)return t();const e=u;u=null;try{return t()}finally{u=e}}function X(){return u}function C(){if(this.sources&&this.state)if(this.state===f)w(this);else{const t=o;o=null,p(()=>S(this),!1),o=t}if(u){const t=this.observers?this.observers.length:0;u.sources?(u.sources.push(this),u.sourceSlots.push(t)):(u.sources=[this],u.sourceSlots=[t]),this.observers?(this.observers.push(u),this.observerSlots.push(u.sources.length-1)):(this.observers=[u],this.observerSlots=[u.sources.length-1])}return this.value}function U(t,e,s){let r=t.value;return(!t.comparator||!t.comparator(r,e))&&(t.value=e,t.observers&&t.observers.length&&p(()=>{for(let n=0;n<t.observers.length;n+=1){const l=t.observers[n],c=m&&m.running;c&&m.disposed.has(l),(c?!l.tState:!l.state)&&(l.pure?o.push(l):a.push(l),l.observers&&N(l)),c||(l.state=f)}if(o.length>1e6)throw o=[],new Error},!1)),e}function w(t){if(!t.fn)return;h(t);const e=E;F(t,t.value,e)}function F(t,e,s){let r;const n=i,l=u;u=i=t;try{r=t.fn(e)}catch(c){return t.pure&&(t.state=f,t.owned&&t.owned.forEach(h),t.owned=null),t.updatedAt=s+1,R(c)}finally{u=l,i=n}(!t.updatedAt||t.updatedAt<=s)&&(t.updatedAt!=null&&"observers"in t?U(t,r):t.value=r,t.updatedAt=s)}function A(t,e,s,r=f,n){const l={fn:t,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:i,context:i?i.context:null,pure:s};return i===null||i!==O&&(i.owned?i.owned.push(l):i.owned=[l]),l}function v(t){if(t.state===0)return;if(t.state===g)return S(t);if(t.suspense&&y(t.suspense.inFallback))return t.suspense.effects.push(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<E);)t.state&&e.push(t);for(let s=e.length-1;s>=0;s--)if(t=e[s],t.state===f)w(t);else if(t.state===g){const r=o;o=null,p(()=>S(t,e[0]),!1),o=r}}function p(t,e){if(o)return t();let s=!1;e||(o=[]),a?s=!0:a=[],E++;try{const r=t();return $(s),r}catch(r){s||(a=null),o=null,R(r)}}function $(t){if(o&&(k(o),o=null),t)return;const e=a;a=null,e.length&&p(()=>x(e),!1)}function k(t){for(let e=0;e<t.length;e++)v(t[e])}function j(t){let e,s=0;for(e=0;e<t.length;e++){const r=t[e];r.user?t[s++]=r:v(r)}for(e=0;e<s;e++)v(t[e])}function S(t,e){t.state=0;for(let s=0;s<t.sources.length;s+=1){const r=t.sources[s];if(r.sources){const n=r.state;n===f?r!==e&&(!r.updatedAt||r.updatedAt<E)&&v(r):n===g&&S(r,e)}}}function N(t){for(let e=0;e<t.observers.length;e+=1){const s=t.observers[e];s.state||(s.state=g,s.pure?o.push(s):a.push(s),s.observers&&N(s))}}function h(t){let e;if(t.sources)for(;t.sources.length;){const s=t.sources.pop(),r=t.sourceSlots.pop(),n=s.observers;if(n&&n.length){const l=n.pop(),c=s.observerSlots.pop();r<n.length&&(l.sourceSlots[c]=r,n[r]=l,s.observerSlots[r]=c)}}if(t.tOwned){for(e=t.tOwned.length-1;e>=0;e--)h(t.tOwned[e]);delete t.tOwned}if(t.owned){for(e=t.owned.length-1;e>=0;e--)h(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}t.state=0}function P(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function R(t,e=i){throw P(t)}function Y(t,e){return y(()=>t(e||{}))}export{d as $,M as a,V as b,I as c,Q as d,G as e,W as f,X as g,K as h,Y as i,y as u};
